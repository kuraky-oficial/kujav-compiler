// src/parser/kujav.pest
program = { SOI ~ (declaration | statement)* ~ EOI }

declaration = { fun_decl | let_decl }
let_decl    = { "let" ~ identifier ~ "=" ~ expression }
fun_decl    = { "fun" ~ identifier ~ "(" ~ parameter_list? ~ ")" ~ "{" ~ (declaration | statement)* ~ "}" }

parameter_list = { identifier ~ ("," ~ identifier)* }

// Estilo Lua: print sin par√©ntesis
statement = { if_stmt | print_stmt | let_decl }
print_stmt = { "print" ~ expression }

if_stmt = { "if" ~ expression ~ "{" ~ (declaration | statement)* ~ "}" }

// Niveles de precedencia para evitar el error 'primary'
expression = { term ~ (comp_op ~ term)* }
comp_op    = { "==" | "<" | ">" }

term   = { factor ~ (add_op ~ factor)* }
add_op = { "+" | "-" }

factor = { primary ~ (mul_op ~ primary)* }
mul_op = { "*" | "/" }

primary = { string | number | identifier }

identifier = @{ ASCII_ALPHA ~ (ASCII_ALPHANUMERIC | "_")* }
number     = @{ ASCII_DIGIT+ }
string     = { "\"" ~ (!"\"" ~ ANY)* ~ "\"" }

WHITESPACE = _{ " " | "\t" | "\r" | "\n" }
COMMENT    = _{ "--" ~ (!"\n" ~ ANY)* }